# 美团买菜-抢菜捡漏脚本

此脚本只是用来保护脆弱的手指, 并不能提高早上6点的时候抢菜的成功率, 但是睡眠质量应该还是能提高一点的, 同时家庭也能和睦一些 o(*￣▽￣*)ブ

* 在`zgl018`脚本(自动下单)的基础上, 主要增加了捡漏的功能, 其他细节进行了优化
* 仅支持Android, 适配`美团买菜 5.32.10`, 需要在`Auto.js 4.1.1 Alpha2` 下运行
* 适配机型: 三星Note9, Android 10

调试及使用教程可参考: https://github.com/qulingyuan/robVeg

补充说明:
1. 在手机`/Download`目录下放置一首`success.mp3`的歌曲(完整路径: `/storage/emulated/0/Download/success.mp3`), 抢单成功的时候会播放音乐提醒, **15分钟内支持**
2. 按`音量+`键手工停止脚本


参考代码:
* 下拉刷新代码参考 https://www.d1blog.com/autojs/1752.html
* 核心代码来自 https://gist.github.com/zgl018/742b661edd2902e80db4bfca59d01e1a

已知问题:
* ~~到了支付页面不会自动点击`立即支付`~~
* 高峰期程序有时候会卡住不动(每天6点优化中)
* ~~是否购物车是否已经全选有问题, 一直返回未选中(实际貌似点击后也不会取消全选)~~
* ~~选择时间,点击`立即支付`之后, 拥堵情况下会导致程序卡住~~

# 更新记录

### 22/04/19
* 已启用自动点击免密支付, 已启用自动点击免密支付, 已启用自动点击免密支付 (出现`免密支付`按钮之后开始播放音乐提醒, 1分钟之后点击支付, 如果不需要期间可按`音量+`停止脚本)
* 捡漏成功之后, 休息3分钟左右, 会重新开始捡漏, 最多持续5轮

### 22/04/18
* 结算, 选择时间, 立即支付都增加容错逻辑
* 全选商品, 刚好碰到商品又没有了的情况, 进行容错处理
* 增加第一件商品的日志打印, 没抢到的情况下可以知道自己错过了什么好东西...
* 修复调用2000余次出现的内存溢出导致程序中断的问题

### 22/04/17
* 抢单成功的提醒音乐名称修改为success.mp3
* 立即支付增加重试机制
* 通过结算按钮文字判断是否已选择商品
* 单次捡漏最多执行约2小时

### 22/04/16
* 在结算前先全选商品
* 修复不会点击`立即支付`的问题
